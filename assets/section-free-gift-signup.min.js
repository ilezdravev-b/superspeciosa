!function(e){"function"==typeof define&&define.amd?define("freeGiftSignup",e):e()}((function(){"use strict";let e=null;const t={firstName:"",lastName:"",email:"",address:"",apartment:"",city:"",state:"",stateName:"",zipCode:""},n=function(){const e=document.querySelector(".free-gift-signup-modal"),t=document.querySelector(".free-gift-signup-overlay");e.classList.remove("hidden"),t.classList.remove("hidden"),document.querySelector(".step-1").style.display="",document.querySelector(".step-2").style.display="",document.querySelector(".step-3").style.display="",document.body.classList.add("free-gift-signup-open"),s(),i(1)},o=function(){const e=document.querySelector(".free-gift-signup-modal"),t=document.querySelector(".free-gift-signup-overlay");e.classList.add("hidden"),t.classList.add("hidden"),document.body.classList.remove("free-gift-signup-open"),s()},i=function(e){document.querySelectorAll(".step-content").forEach(((t,n)=>{t.classList.add("hidden"),n===e-1&&t.classList.remove("hidden")})),c(e),s()},a=e=>{const t=document.querySelector(".error-message");t.textContent=e,t.style.display="block"},s=()=>{document.querySelector(".error-message").style.display="none"},c=function(e){document.querySelectorAll(".step-indicator .step").forEach(((t,n)=>(t.innerHTML=n+1,n<e-1?(t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="white" d="M18.047,4,22,8.325,9.3,20,2,12.68,6.136,8.533,9.474,11.88Z"/></svg>',void(t.style.backgroundColor="green")):n===e-1?(t.style.backgroundColor="black",void(t.style.color="white")):(t.style.backgroundColor="",void(t.style.color="black")))))},r=function(e){const t=parseInt(e.target.getAttribute("data-next-step")),n=parseInt(e.target.getAttribute("data-prev-step"));isNaN(t)?isNaN(n)||i(n):p(t-1)},d=()=>document.querySelector("#int-tel-input").value.trim(),u=async()=>{const e=d(),t=new Headers;t.append("Content-Type","application/json");const n={method:"POST",headers:t,body:JSON.stringify({phoneNumber:e}),redirect:"follow"};try{const e=await fetch("https://us-west1-silverponies.cloudfunctions.net/superspeciosa-initiate-validation",n);return await e.text()}catch(e){throw console.error(e),new Error("Failed to send code. Please try again.")}},l=e=>{e.preventDefault(),p(3)},m=()=>{p(4)},p=async n=>{try{switch(n){case 1:if(!(()=>{let e=document.querySelector("#int-tel-input").value.trim();return e=e.replace(/\D/g,""),e?!!/^[0-9]{10}$/.test(e)||(a("Please enter a valid phone number."),!1):(a("You will have to provide a phone Number before you can verify it."),!1)})())return;const n=await u();if(!JSON.parse(n).newCustomer)return void a("This phone number has already been used to receive Free Samples");break;case 2:if(!(()=>{const e=document.querySelector("#input-mask-code").value.trim();return!e.includes("_")&&6===e.length||(a("Please enter the code you received in your phone number"),!1)})())return;const o=await(async()=>{const e=document.querySelector("#input-mask-code").value.trim(),t=d(),n=new Headers;n.append("Content-Type","application/json");const o={method:"POST",headers:n,body:JSON.stringify({phoneNumber:t,verificationCode:e}),redirect:"follow"};try{const e=await fetch("https://us-west1-silverponies.cloudfunctions.net/superspeciosa-confirm-validation",o);return await e.text()}catch(e){throw console.error(e),new Error("Failed to verify code. Please try again.")}})();if("Invalid verification code"===o)return void a("The code you entered is incorrect. Please try again.");const i=JSON.parse(o);if(!i.verified)return void a("The code you entered is incorrect. Please try again.");e=i.customerId;break;case 3:if(!(()=>{const e=document.querySelector(".first-name-input").value.trim(),n=document.querySelector(".last-name-input").value.trim(),o=document.querySelector(".address-input").value.trim(),i=document.querySelector(".city-input").value.trim(),s=document.querySelector(".state-select").value.trim();var c=document.querySelector(".state-select");const r=c.options[c.selectedIndex].innerHTML,d=document.querySelector(".zip-code-input").value.trim(),u=document.querySelector(".email-input").value.trim(),l=[];return e||l.push("First name"),n||l.push("Last name"),o||l.push("Address"),i||l.push("City"),s||l.push("State"),d||l.push("ZIP Code"),u||l.push("Email"),l.length>0?(a(`The following fields are required: ${l.join(", ")}.`),!1):(t.firstName=e,t.lastName=n,t.email=u,t.address=o,t.apartment=document.querySelector(".apartment-input").value.trim(),t.city=i,t.state=s,t.stateName=r,t.zipCode=d,!0)})())return;(()=>{const e=document.querySelector(".confirmation-details");e.innerHTML="",[{label:"First Name",value:t.firstName},{label:"Last Name",value:t.lastName},{label:"Address",value:t.address},{label:"Apartment, suite, etc. ",value:t.apartment},{label:"City",value:t.city},{label:"State",value:t.state},{label:"ZIP Code",value:t.zipCode},{label:"Email",value:t.email}].forEach((t=>{if(t.value){const n=document.createElement("p");n.textContent=`${t.label}: ${t.value}`,e.appendChild(n)}}))})();break;case 4:await(async()=>{const n=new Headers;n.append("Content-Type","application/json");const o={method:"POST",headers:n,body:JSON.stringify({customerId:e,customer:{email:t.email,first_name:t.firstName,last_name:t.lastName,id:e,addresses:[{address1:t.address,address2:t.apartment,city:t.city,province_code:t.state,province:t.stateName,country:"United States",zip:t.zipCode,country_name:"United States",default:!0}],email_marketing_consent:{state:"subscribed",opt_in_level:"single_opt_in",consent_updated_at:(new Date).toString(),consent_collected_from:"OTHER"},sms_marketing_consent:{state:"subscribed",opt_in_level:"single_opt_in",consent_updated_at:(new Date).toString(),consent_collected_from:"OTHER"},tags:"FREEBIE"}}),redirect:"follow"};try{const e=await fetch("https://us-west1-silverponies.cloudfunctions.net/superspeciosa-update-customer-v2",o),t=await e.json();if(t.updatedCustomer&&t.updatedCustomer.errors)throw new Error("This could not be processed because you have already received a free sample. If this is an error, please contact us.");document.querySelector(".free-gift-signup-modal > .title").innerText="Congratulations! Your Kratom Goodies are on their way!",document.querySelector(".step-1").style.display="none",document.querySelector(".step-2").style.display="none",document.querySelector(".step-3").style.display="none"}catch(e){throw console.error(e),e}})()}i(n+1)}catch(e){i(n),a(e.message)}},f=async()=>{await u()};document.addEventListener("DOMContentLoaded",(function(){(()=>{const e=document.querySelectorAll("button[data-next-step], button[data-prev-step]"),t=document.querySelector(".btn-open"),i=document.querySelector(".btn-close");t.addEventListener("click",n),i.addEventListener("click",o),e.forEach((e=>{e.addEventListener("click",r)})),document.querySelector(".resend-code-button").addEventListener("click",f),document.querySelector(".step-content form").addEventListener("submit",l),document.querySelector("#final-submit-button").addEventListener("click",m)})(),(()=>{const e=document.querySelector("#int-tel-input");window.intlTelInput(e,{utilsScript:"https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.10/build/js/utils.js",initialCountry:"us",separateDialCode:!0})})(),(()=>{const e=document.getElementById("input-mask-code");IMask(e,{mask:"000000",definitions:{0:{mask:/\d/,placeholderChar:"_"}},lazy:!1,overwrite:"shift"}),e.style.display="none";const t=document.querySelector("#fake-code-input");t.addEventListener("click",(()=>{t.style.display="none",e.style.display="block",e.focus()}))})()}))}));