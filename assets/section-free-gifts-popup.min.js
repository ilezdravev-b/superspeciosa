!function(t){"function"==typeof define&&define.amd?define("freeGiftsPopup",t):t()}((function(){"use strict";const t=async(t,e=null,n=!0)=>{try{const r=await(o=t,a=e,a=a||{},new Promise((function(t,e){var n=new XMLHttpRequest,r=[],i=[],c={},d=function(){return{ok:2==(n.status/100|0),statusText:n.statusText,status:n.status,url:n.responseURL,text:function(){return Promise.resolve(n.responseText)},json:function(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([n.response]))},clone:d,headers:{keys:function(){return r},entries:function(){return i},get:function(t){return c[t.toLowerCase()]},has:function(t){return t.toLowerCase()in c}}}};for(var s in n.open(a.method||"get",o,!0),n.onload=function(){n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(t,e,n){r.push(e=e.toLowerCase()),i.push([e,n]),c[e]=c[e]?c[e]+","+n:n})),t(d())},n.onerror=e,n.withCredentials="include"==a.credentials,a.headers)n.setRequestHeader(s,a.headers[s]);n.send(a.body||null)})));if(!r.ok)throw Error(r.statusText);if(n)return await r.json();if(!n)return await r.text()}catch(t){console.error(t)}var o,a},e=window.Shopify.routes.root,n="_isFreeGift",o="_priceRuleId",a=["ajaxCartContent","ajaxCartBtn","cartContent","announcementBars"],r=t=>{const e=[];for(const t of a){const n=document.getElementById(t);n&&e.push({replacedContentId:t,sectionId:n.closest(".shopify-section").id.replace("shopify-section-","")})}return t?e.map((t=>t.sectionId)):e},i=async()=>{const n=await t(`${e}cart.js`,{credentials:"same-origin"});return window.EventBus.emit("cart:fetched",n),n},c=async n=>{const o={method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:n,sections:r(!0)})};return await t(`${e}cart/add.js`,o)},d="data-variant-id",s={btn:'[data-behavior="ajax-cart-button"]',variantData:`[${d}]`},u=(t,e,n)=>{n.includes("Adding")||n.includes("adding")?t.style.width=`${t.offsetWidth}px`:t.removeAttribute("style"),t.disabled=!!e,t.innerHTML=n};document.addEventListener("click",(t=>{const e=t.target,n=e.closest(s.btn),o=e.closest(s.variantData);if(!n||!o)return;t.preventDefault();const a=n.innerHTML,r=o.getAttribute(d);c([{id:r,quantity:1}]).then((t=>{window.EventBus.emit("cart:item:added",t),window.EventBus.emit("cart:updated",t),window.EventBus.emit("cart:update:popup"),u(n,!1,a)})).catch((t=>{console.error(t),u(n,!1,a),(t=>{const e=document.getElementById("screenReaderStatus");e.textContent="",e.textContent=t})(window.fmData.cartStrings.error)}))}));const l="#FreeGiftsPopup",p=".js-add-free-gift",w="#ajaxCartBtn",f="data-variant-id",m="data-product-id",y="data-product-price",g="data-tier-min",h="data-tier-max",S="data-cart-total-price",C="aria-expanded",b="FreeGiftsPopup",T="_isFreeGift",v="_minCartPrice",P="_maxCartPrice",j="_promoCode",O="_priceRuleId",x=document.querySelector(l),G=document.querySelector(w),_="https://triple-tier-gift-rpzwsjix5q-uc.a.run.app",B=t=>{for(const e of t)if(e.hasOwnProperty("properties")&&null!==e.properties&&e.properties.hasOwnProperty(T))return!0;return!1},D=()=>{let t=document.querySelector(l);const e=parseFloat(document.querySelector(".final-cart-total")?.innerText.replace("$",""))||0,n=parseFloat(t.dataset["tier-1Min"])/100,o=parseFloat(t.dataset["tier-2Min"])/100,a=parseFloat(t.dataset["tier-3Min"])/100;return!!t&&(e>=a&&e>o&&e>n?"tier3"===localStorage.getItem("activeTier")||(localStorage.setItem("activeTier","tier3"),localStorage.removeItem("freeGiftDeniedByCustomer"),!1):e>=o&&e>n?"tier2"===localStorage.getItem("activeTier")||(localStorage.setItem("activeTier","tier2"),localStorage.removeItem("freeGiftDeniedByCustomer"),!1):e>=n?"tier1"===localStorage.getItem("activeTier")||(localStorage.setItem("activeTier","tier1"),localStorage.removeItem("freeGiftDeniedByCustomer"),!1):(localStorage.setItem("activeTier","none"),!1))},E=()=>{!G||"BUTTON"!=G.tagName||"true"!=G.getAttribute(C)&&1!=G.getAttribute(C)||G.click()},I=async()=>fetch(window.fmData.theme.localeRootUrl+"/cart?view=ajax&timestamp="+Date.now(),{credentials:"same-origin",method:"GET"}).then((t=>t.text())).then((t=>{if(x){const e=(new DOMParser).parseFromString(t,"text/html").documentElement.querySelector(`#${b}`).parentElement;document.getElementById(b).parentElement.innerHTML=e.innerHTML,window.EventBus.emit("content:changed")}})),$=async n=>{const o=n.items.filter((t=>t.hasOwnProperty("properties")&&null!==t.properties&&t.properties.hasOwnProperty(T))),a=o.length>0&&o[0];if(!a)return n;{let o={};const i=n.total_price,c=parseInt(a.properties[v]),d=parseInt(a.properties[P]),s=i-a.price;if(s<c||s>d)return o[a.key]=0,(async n=>{const o={method:"POST",credentials:"same-origin",body:JSON.stringify({updates:n,sections:r(!0)}),headers:{"Content-Type":"application/json"}},a=await t(`${e}cart/update.js`,o);return window.EventBus.emit("cart:updated",a),a})(o)}},F=async()=>{i().then((a=>{const c=a.items.filter((t=>t.hasOwnProperty("properties")&&null!==t.properties&&t.properties.hasOwnProperty(T))),d=c.length>0&&c[0];if(d){return(async(a,c)=>{const d={method:"POST",credentials:"same-origin",body:JSON.stringify({line:a,quantity:c,sections:r(!0)}),headers:{"Content-Type":"application/json"}},s=a-1,u=(await i()).items[s];if(!u)return;if(0==c&&u.hasOwnProperty("properties")&&null!==u.properties&&u.properties.hasOwnProperty(n)&&u.properties.hasOwnProperty(o)){let t={priceRuleId:u.properties[o]};const e=new CustomEvent("deletePromoCode",{bubbles:!1,cancelable:!0,detail:t});window.dispatchEvent(e)}return await t(`${e}cart/change.js`,d)})(((t,e)=>{for(let n=0;n<t.length;n++)if(t[n].key==e.key)return n+1;return!1})(a.items,d),0)}return a}))},N=()=>{const t=localStorage.getItem("freeGiftDeniedByCustomer");if(x&&!t){let t={id:x.id};const e=new CustomEvent("showModal",{bubbles:!1,cancelable:!0,detail:t});window.dispatchEvent(e)}},R=async()=>{const t=await i();t&&I().then((()=>{!B(t.items)&&D()?(N(),E()):B(t.items)&&!D()&&$(t).then((t=>{window.EventBus.emit("cart:updated",t)}))}))};document.addEventListener("click",(async t=>{const e=t.target.closest(p);if(!e)return;const n=e.innerHTML;u(e,!0,"Adding...");const o=!!e.hasAttribute(m)&&e.getAttribute(m),a=!!e.hasAttribute(f)&&e.getAttribute(f),r=!!e.hasAttribute(g)&&e.getAttribute(g),i=!!e.hasAttribute(h)&&e.getAttribute(h),d=!!e.hasAttribute(y)&&e.getAttribute(y),s=!!e.hasAttribute(S)&&e.getAttribute(S);F().then((async()=>{const t={product_id:parseInt(o),cart_total:s/100,item_price:d/100,operation:"CREATE"},l=await fetch(_,{body:JSON.stringify(t),headers:{"Content-Type":"application/json"},method:"POST"}),{code:p,priceRuleId:w}=await l.json();if(p){let t={};t[T]=!0,t[v]=r,t[P]=i,t[j]=p,t[O]=w,c([{id:a,quantity:1,properties:t}]).then((t=>{if(window.EventBus.emit("cart:item:added",t),window.EventBus.emit("cart:updated",t),window.location.href.includes("/cart")||(window.EventBus.emit("cart:update:popup"),window.EventBus.emit("option:reload")),u(e,!1,n),t.items[0].properties.hasOwnProperty(T)){const t=new CustomEvent("closeModal",{bubbles:!1,cancelable:!0,detail:{id:b,hideOverlay:!0}});window.dispatchEvent(t)}})).catch((t=>{console.error(t),u(e,!1,n),updateA11yStatus(window.fmData.cartStrings.error)}))}else console.log("No code could be generated. Please verify product id and cart total price.")}))})),window.EventBus.on("cart:markup:updated",R),window.EventBus.on("gift:declined",(()=>{localStorage.getItem("freeGiftDeniedByCustomer")||localStorage.setItem("freeGiftDeniedByCustomer",!0)})),window.addEventListener("formAddedtoCart",R),window.addEventListener("deletePromoCode",(function(t){t.detail.priceRuleId&&(t=>{const e={price_rule_id:t,operation:"DELETE"};fetch(_,{body:JSON.stringify(e),headers:{"Content-Type":"application/json"},method:"POST"})})(t.detail.priceRuleId)})),window.addEventListener("modalShowing",(function(t){t.detail.id==b&&E()})),window.addEventListener("load",(function(){(async()=>{if(x){const t=await i();t&&I().then((()=>{B(t.items)?D()||$(t).then((t=>{window.EventBus.emit("cart:updated",t)})):D()&&N()}))}})()}))}));