!function(t){"function"==typeof define&&define.amd?define("predictiveSearch",t):t()}((function(){"use strict";class t extends HTMLElement{constructor(){super(),this.container=this,this.outerContainer=this.parentElement,this.input=this.querySelector('input[type="search"]'),this.hasResults=!1,this.resultsLimit=3,this.resultsLimitType="each",this.sectionId="predictive-search-results",this.contentSelector=".js-predictive-search-results",this.resultLocations=document.querySelectorAll(this.contentSelector)}connectedCallback(){this.input.addEventListener("input",function(t,e=300){let s;return(...i)=>{clearTimeout(s),s=setTimeout((()=>{t.apply(this,i)}),e)}}((()=>{this.t()}),300).bind(this)),this.outerContainer.addEventListener("keydown",this.i.bind(this))}o(t=""){for(const e of this.resultLocations)e.innerHTML=t}i(t){const e=t.key,s=t.target;"Escape"==e&&this.h(t,s),"Tab"==e&&this.u()}async u(){var t;await(t=10,t=t||2e3,new Promise((e=>{setTimeout((()=>{e()}),t)})));const e=document.activeElement;this.outerContainer.contains(e)||this.h(null,null,!1)}l(t,e){const s=e&&e.value&&e.value.length>0,i=e&&e.closest(this.contentSelector);(s||i&&i.contains(e))&&(t.stopPropagation(),t.stopImmediatePropagation())}h(t,e,s=!0){t&&this.l(t,e),this.o(),s&&(e&&e==this.input&&(this.input.value=""),this.input.focus()),this.hasResults=!1}async t(){const t=this.input.value.trim();if(!t||0==t.length)return void this.o();const e=await this.p(t);this.m(e)}async _(t){try{const e=await fetch(`/search/suggest?q=${encodeURIComponent(t)}&${encodeURIComponent("resources[type]")}=product,collection,article,page&${encodeURIComponent("resources[options][unavailable_products]")}=last&${encodeURIComponent("resources[limit]")}=${this.resultsLimit}&${encodeURIComponent("resources[limit_scope]")}=${this.resultsLimitType}&${encodeURIComponent("section_id")}=${this.sectionId}`);return await e.text()}catch(t){console.error(t),this.o()}}async p(t){const e=await this._(t),s=(new DOMParser).parseFromString(e,"text/html").querySelector(this.contentSelector).innerHTML;return this.hasResults=!0,s}m(t=""){this.o(t),window.EventBus.emit("content:changed")}}var e,s;e="predictive-search",s=t,void 0===customElements.get(e)&&customElements.define(e,s)}));