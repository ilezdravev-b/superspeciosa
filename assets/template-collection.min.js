!function(t){"function"==typeof define&&define.amd?define("collection",t):t()}((function(){"use strict";const t=async(t,o=null,n=!0)=>{try{const r=await(e=t,c=o,c=c||{},new Promise((function(t,o){var n=new XMLHttpRequest,r=[],i=[],s={},l=function(){return{ok:2==(n.status/100|0),statusText:n.statusText,status:n.status,url:n.responseURL,text:function(){return Promise.resolve(n.responseText)},json:function(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([n.response]))},clone:l,headers:{keys:function(){return r},entries:function(){return i},get:function(t){return s[t.toLowerCase()]},has:function(t){return t.toLowerCase()in s}}}};for(var u in n.open(c.method||"get",e,!0),n.onload=function(){n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(t,o,n){r.push(o=o.toLowerCase()),i.push([o,n]),s[o]=s[o]?s[o]+","+n:n})),t(l())},n.onerror=o,n.withCredentials="include"==c.credentials,c.headers)n.setRequestHeader(u,c.headers[u]);n.send(c.body||null)})));if(!r.ok)throw Error(r.statusText);if(n)return await r.json();if(!n)return await r.text()}catch(t){console.error(t)}var e,c},o="loading",n=".js-filters",e=".js-filters-results-count",c=".js-filters-group",r=".js-filters-clear-all",i=".js-filters-clear-all-desktop",s=".js-filters-clear-group",l=".js-filters-active-count",u=".js-collection-filter-group",f=".js-collection-filter-item.hide",a=".js-show-collection-filter-group",d=".js-collection-filter",w="data-collection-url",h="collectionProducts",m=document.getElementById("collectionContainer"),g=document.getElementById("collectionFilters"),j=document.getElementById(h),p=async o=>{k(!0);const n=await t(o,void 0,!1),e=y(n,o),c=JSON.parse(e.querySelector("#filterData").textContent);P(c),window.EventBus.emit("content:changed"),k(!1);let r="products";1===c.totalResults&&(r="product"),(t=>{const o=document.getElementById("screenReaderStatus");o.textContent="",o.textContent=t})(`${c.totalResults} ${r} found`),g.querySelector(i)&&(c.activeValues<1?g.querySelector(i).classList.add("hide"):g.querySelector(i).classList.remove("hide")),b()},b=()=>{if(g.querySelector(s))for(const t of[...g.querySelectorAll(s)]){let o=!1;const n=t.closest(c);if(n)for(const e of[...n.querySelectorAll(d)])e.checked&&(o=!0,t.classList.remove("hide"));o||t.classList.add("hide")}},y=(t,o)=>{const n=(new DOMParser).parseFromString(t,"text/html").documentElement.querySelector(`#${h}`);return document.getElementById(h).innerHTML=n.innerHTML,window.history.pushState({},"",o),n},k=t=>{t&&(m.classList.add(o),g.classList.add(o)),t||(m.classList.remove(o),g.classList.remove(o))},P=t=>{const o=[...document.querySelectorAll(e)],n=[...document.querySelectorAll(l)];for(const n of o)n.textContent=t.totalResults;for(const o of n)o.textContent=t.activeValues},$=t=>{let o=new URL(window.location.href),n="";for(const o of[...t.querySelectorAll(d)])o.checked&&(n=n+"+"+o.value);n=n.slice(1);let e=new URL(m.getAttribute(w)+n);o.searchParams.get("sort_by")&&e.searchParams.set("sort_by",o.searchParams.get("sort_by")),p(e)},v=t=>{for(const o of t.querySelectorAll(`${d}:checked`))o.checked=!1},R=t=>{const o=t.target,e=o.closest(n),c=o.type;e&&c&&("checkbox"==c&&t.target.checked&&S(e,t.target),setTimeout((()=>{$(e)}),10))},S=(t,o)=>{for(const n of[...t.querySelectorAll(`[name="${o.name}"]`)])n.value!=o.value&&(n.checked=!1)},x=t=>{const o=t.target.closest(a),e=t.target.closest(r),i=t.target.closest(s);o&&(t=>{const o=t.target.closest(a),n=t.target.closest(u),e=!(!n||!n.querySelector(f))&&[...n.querySelectorAll(f)];if(o&&n&&e){for(const t of e)t.classList.remove("hide");o.parentElement.classList.add("hide")}})(t),e&&(t=>{t.preventDefault(),v(g);let o=new URL(m.getAttribute(w));o&&p(o)})(t),i&&(t=>{t.preventDefault();const o=t.target,e=o.closest(c);if(!e)return;v(e);const r=o.closest(n);$(r)})(t)};m&&g&&j&&(b(),g.addEventListener("change",R),g.addEventListener("click",x)),document.querySelectorAll(".rte-toggle-button").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault(),document.querySelector(".collection-description").classList.add("show-all-description")}))}))}));